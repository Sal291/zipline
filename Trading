import pandas as pd
import yfinance as yf

data = yf.download("AAPL", start="2020-01-01", end="2021-01-01")
data['SMA_50'] = data['Close'].rolling(window=50).mean()
data['RSI'] = compute_rsi(data['Close'])
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier

features = data[['SMA_50', 'RSI']].dropna()
X = features.values
y = (data['Close'].shift(-1) > data['Close']).astype(int).values[:-1]

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model = RandomForestClassifier()
model.fit(X_train, y_train)
from backtrader import Cerebro, Strategy

class MyStrategy(Strategy):
    def __init__(self):
        self.sma = bt.indicators.SMA(self.data.close, period=50)
        self.rsi = bt.indicators.RSI(self.data.close)
    
    def next(self):
        if self.rsi < 30 and self.data.close > self.sma:
            self.buy()
        elif self.rsi > 70 and self.data.close < self.sma:
            self.sell()

cerebro = Cerebro()
cerebro.addstrategy(MyStrategy)
cerebro.run()
cerebro.plot()
